<%- include('partial/admin-head.ejs') %>
<body class="ec-header-fixed ec-sidebar-fixed ec-sidebar-dark ec-header-light" id="body">

	<!-- WRAPPER -->
	<div class="wrapper">

		<!-- LEFT MAIN SIDEBAR -->
		<%- include('partial/admin-sidebar.ejs') %> 

		<!-- PAGE WRAPPER -->
		<div class="ec-page-wrapper">

			<!-- Header -->
			<%- include('partial/admin-header.ejs') %> 
			
			<!-- CONTENT WRAPPER -->
			<div class="ec-content-wrapper">
				<div class="content">
					<div class="breadcrumb-wrapper breadcrumb-wrapper-2">
						<h1>Order Detail</h1>
						<p class="breadcrumbs"><span><a href="index.html">Home</a></span>
							<span><i class="mdi mdi-chevron-right"></i></span>Orders
						</p>
					</div>
					<div class="row">
						<div class="col-12">
							<div class="card mt-4 trk-order">
								<div class="p-4 text-center text-white text-lg bg-dark rounded-top">
									<span class="text-uppercase">Tracking Order No - </span>
									<span class="text-medium">34VB5540K83</span>
								</div>
								<div
									class="d-flex flex-wrap flex-sm-nowrap justify-content-between py-3 px-2 bg-secondary">
									<div class="w-100 text-center py-1 px-2"><span class="text-medium">Shipped
											Via:</span> UPS Ground</div>
									<div class="w-100 text-center py-1 px-2"><span class="text-medium">Status:</span>
										Checking Quality</div>
									<div class="w-100 text-center py-1 px-2"><span class="text-medium">Expected
											Date:</span> DEC 09, 2021</div>
								</div>
								<div class="card-body">
									<div
										class="steps d-flex flex-wrap flex-sm-nowrap justify-content-between padding-top-2x padding-bottom-1x">
										<div class="<%=order.status='confirmed' ? 'step completed' : 'step'; %>">
											<div class="step-icon-wrap">
												<div class="step-icon"><i class="mdi mdi-cart"></i></div>
											</div>
											<h4 class="step-title">Confirmed Order</h4>
										</div>
										<div class="<%= order.status='processing' ? 'step completed' : 'step'; %>">
											<div class="step-icon-wrap">
												<div class="step-icon"><i class="mdi mdi-tumblr-reblog"></i></div>
											</div>
											<h4 class="step-title">Processing Order</h4>
										</div>
										<div class="<%=order.status='dispatched' ? 'step completed' : 'step'; %>">
											<div class="step-icon-wrap">
												<div class="step-icon"><i class="mdi mdi-gift"></i></div>
											</div>
											<h4 class="step-title">Product Dispatched</h4>
										</div>
										<div class="<%=order.status='out-for-delivery' ? 'step completed' : 'step'; %>">
											<div class="step-icon-wrap">
												<div class="step-icon"><i class="mdi mdi-truck-delivery"></i></div>
											</div>
											<h4 class="step-title">On Delivery</h4>
										</div>
										<div class="<%=order.status='delivered' ? 'step completed' : 'step'; %>">
											<div class="step-icon-wrap">
												<div class="step-icon"><i class="mdi mdi-hail"></i></div>
											</div>
											<h4 class="step-title">Product Delivered</h4>
										</div>
									</div>
								</div>
							</div>
							<div class="ec-odr-dtl card card-default">
								<div class="card-header card-header-border-bottom d-flex justify-content-between">
									<h2 class="ec-odr">Order Detail<br>
										<form action="">
											<div class="form-floating">
											  <select class="form-select" id="order-status-updater" data-id="<%= order._id %>" aria-label="Floating label select example">
												<option value="confirmed" <%= order.status === 'confirmed' ? 'selected' : '' ; %>>Confirmed</option>
												<option value="processing" <%= order.status === 'processing' ? 'selected' : '' ; %>>Processing</option>
												<option value="dispatched" <%= order.status === 'dispatched' ? 'selected' : '' ; %>>Dispatched</option>
												<option value="out-for-delivery" <%= order.status === 'out-for-delivery' ? 'selected' : '' ; %>>Out-for-delivery</option>
												<option value="delivered" <%= order.status === 'delivered' ? 'selected' : '' ; %>>Delivered</option>
												<option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' ; %>>Cancelled</option>
											  </select>
											  <label for="floatingSelect">Order Status</label>
											</div>
										  </form>
										<span class="small">Order ID:<%= order._id  %> </span>
									</h2>
								</div>
								
								<div class="card-body">
									<div class="row">
										<div class="col-xl-3 col-lg-6">
											<address class="info-grid">
												<div class="info-title"><strong>Customer:</strong></div><br>
												<div class="info-content">
													<%= order.address.firstname+' '+order.address.lastname %> <br>
													<%= order.address.town %><br>													
												</div>
											</address>
										</div>
										<div class="col-xl-3 col-lg-6">
											<address class="info-grid">
												<div class="info-title"><strong>Shipped To:</strong></div><br>
												<div class="info-content">
													<%= order.address.streetaddress %><br>
													<%= order.address.town %><br>
													<%= order.address.postcode %><br>
													<abbr title="Phone">PH:</abbr> <%= order.address.phone %>
												</div>
											</address>
										</div>
										<div class="col-xl-3 col-lg-6">
											<address class="info-grid">
												<div class="info-title"><strong>Payment Method:</strong></div><br>
												<div class="info-content">
													<%= order.paymentType %><br>
													
												</div>
											</address>
										</div>
										<div class="col-xl-3 col-lg-6">
											<address class="info-grid">
												<div class="info-title"><strong>Order Date:</strong></div><br>
												<div class="info-content">
													<%= order.deliveryExpected %><br>
													
												</div>
											</address>
										</div>
									</div>
									<div class="row">
										<div class="col-md-12">
											<h3 class="tbl-title">PRODUCT SUMMARY</h3>
											<div class="table-responsive">
												<table class="table table-striped o-tbl">
													<thead>
														<tr class="line">
															<td><strong>#</strong></td>
															<td class="text-center"><strong>IMAGE</strong></td>
															<td class="text-center"><strong>PRODUCT</strong></td>
															<td class="text-center"><strong>PRICE/UNIT</strong></td>
															<td class="text-right"><strong>QUANTITY</strong></td>
															<td class="text-right"><strong>SUBTOTAL</strong></td>
														</tr>
													</thead>
													
													
													
													<tbody>
															<% for( let i = 0; i < order.productDetails.length; i++ ) { %>
														
														<tr>
															<td>1</td>
															<td><img class="product-img"
																	src="/images/products/<%=order.productDetails[i].product.thumbnail %>" alt="" /></td>
															<td><strong><%=order.productDetails[i].product.product_name %></strong><br>
																<%=order.productDetails[i].product.description %></td>
															<td class="text-center"><%=order.productDetails[i].product.price %></td>
															<td class="text-center"><%=order.productDetails[i].product.quantity %></td>
															<td class="text-right"><%=order.subTotal %></td>
														</tr>
														<% }%> 
														<tr>
															<td colspan="4">
															</td>
															<td class="text-right"><strong>Total</strong></td>
															<td class="text-right"><strong><%=order.totalAmount %></strong></td>
														</tr>

														<tr>
															<td colspan="4">
															</td>
															<td class="text-right"><strong>Payment Status</strong></td>
															<%=console.log(order.status);  %> 
															<td class="text-right"><strong><%=order.status %></strong></td>
														</tr>
													</tbody>
													
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- Tracking Detail -->
							
						</div>
					</div>
				</div> <!-- End Content -->
			</div> <!-- End Content Wrapper -->
			
			<!-- Footer -->
			<footer class="footer mt-auto">
				<div class="copyright bg-white">
					<p>
						Copyright &copy; <span id="ec-year"></span><a class="text-primary"
							href="https://themeforest.net/user/ashishmaraviya" target="_blank"> Ekka Admin
							Dashboard</a>. All Rights Reserved.
					</p>
				</div>
			</footer>

		</div> <!-- End Page Wrapper -->
	</div> <!-- End Wrapper -->
	
	<!-- Common Javascript -->
	<script src="/assets/plugins/jquery/jquery-3.5.1.min.js"></script>
	<script src="/assets/plugins/jquery/jquery.notify.min.js"></script>
	<script src="/assets/plugins/jquery/jquery.bundle.notify.min.js"></script>
	<script src="/assets/js/bootstrap.bundle.min.js"></script>
	<script src="/assets/plugins/simplebar/simplebar.min.js"></script>
	<script src="/assets/plugins/jquery-zoom/jquery.zoom.min.js"></script>
	<script src="/assets/plugins/slick/slick.min.js"></script>

	<!-- Option Switcher -->
	<script src="/assets/plugins/options-sidebar/optionswitcher.js"></script>

	<!-- Ekka Custom -->
	<script src="/assets/js/ekka.js"></script>
	<script>
		const orderStatus = $('#order-status-updater');
		if(orderStatus){
			console.log(orderStatus,'asdasdasdda');
			orderStatus.on('change',async function (event){
				event.preventDefault();
				console.log('ansar');
				const status = $(this).val();
				console.log("ðŸš€ ~ file: order-detail.ejs:235 ~ status", status)
				const id = $(this).data('id');
				console.log("ðŸš€ ~ file: order-detail.ejs:237 ~  id",  id)
				const res =await $.ajax({
					url:'/admin/statusChange',
					method:'PATCH',
					data:{
						status,id
					}
				});
				if(res.status === 'success'){
					window.location.reload();
				}
			});
		}
	</script>
</body>

</html>